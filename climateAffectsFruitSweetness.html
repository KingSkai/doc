<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™šæ‹Ÿå®éªŒå®¤ï¼šæ¢ç©¶æ°”å€™å¦‚ä½•å½±å“ç“œæœç”œåº¦</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f9fc 0%, #e8f4fc 100%);
            min-height: 100vh;
        }
        #container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8f4fc;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        .control-panel {
            background: linear-gradient(135deg, #e8f4fc 0%, #d4e9f9 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #c5e1f4;
        }
        .panel-title {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
        }
        .slider-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #3498db, #2ecc71);
            border-radius: 4px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #e74c3c;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .value-display {
            display: inline-block;
            width: 100px;
            text-align: center;
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
            background: white;
            padding: 5px 10px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        button:active {
            transform: translateY(0);
        }
        #start-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        #reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        #xinjiang-btn {
            background: linear-gradient(135deg, #f39c12 0%, #d35400 100%);
        }
        #zhejiang-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }
        .data-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .data-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }
        .data-label {
            font-size: 1.2em;
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .data-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
        }
        .data-unit {
            font-size: 1em;
            color: #6c757d;
            margin-left: 5px;
        }
        .chart-container {
            height: 500px;
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        .explanation {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-radius: 12px;
            border-left: 5px solid #f39c12;
        }
        .explanation h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        .explanation p {
            color: #856404;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .button-container {
                grid-template-columns: 1fr;
            }
            .slider-container {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            label {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="header">
            <h1>ğŸŒµ è™šæ‹Ÿç§‘å­¦å®éªŒå®¤ï¼šæ°”å€™å¯¹ç“œæœç”œåº¦çš„å½±å“ ğŸˆ</h1>
            <div class="subtitle">æ¢ç´¢æ°´åˆ†ã€æ¸©å·®å’Œæ—¶é—´å¦‚ä½•å…±åŒå¡‘é€ æœå®çš„ç”œèœœ</div>
        </div>

        <div class="control-panel">
            <div class="panel-title">å®éªŒå‚æ•°æ§åˆ¶</div>
            <div class="slider-container">
                <label for="water-slider">æ°´åˆ†ä¾›åº”:</label>
                <input type="range" id="water-slider" min="10" max="100" value="50">
                <span id="water-value" class="value-display">50%</span>
            </div>
            <div class="slider-container">
                <label for="temp-slider">æ˜¼å¤œæ¸©å·®:</label>
                <input type="range" id="temp-slider" min="5" max="25" value="10">
                <span id="temp-value" class="value-display">10Â°C</span>
            </div>
            <div class="slider-container">
                <label for="days-slider">æ¨¡æ‹Ÿå¤©æ•°:</label>
                <input type="range" id="days-slider" min="10" max="50" value="30">
                <span id="days-value" class="value-display">30 å¤©</span>
            </div>
        </div>

        <div class="button-container">
            <button id="start-btn">ğŸš€ å¼€å§‹æ¨¡æ‹Ÿ</button>
            <button id="reset-btn">ğŸ”„ é‡ç½®å®éªŒ</button>
            <button id="xinjiang-btn">ğŸœï¸ æ–°ç–†æ¨¡å¼</button>
            <button id="zhejiang-btn">ğŸŒŠ æµ™æ±Ÿæ¨¡å¼</button>
        </div>

        <div class="data-display">
            <div class="data-item">
                <div class="data-label">æœ€ç»ˆç³–åº¦</div>
                <div class="data-value"><span id="final-sugar">0.0</span><span class="data-unit">Â°Bx</span></div>
            </div>
            <div class="data-item">
                <div class="data-label">æœ€ç»ˆå«æ°´é‡</div>
                <div class="data-value"><span id="final-water">0</span><span class="data-unit">%</span></div>
            </div>
            <div class="data-item">
                <div class="data-label">ç”Ÿé•¿æ•ˆç‡</div>
                <div class="data-value"><span id="efficiency">0.0</span><span class="data-unit">%</span></div>
            </div>
        </div>

        <div id="chart" class="chart-container"></div>

        <div class="explanation">
            <h3>ğŸ”¬ ç§‘å­¦åŸç†è¯´æ˜</h3>
            <p>â€¢ <strong>æ°´åˆ†ä¾›åº”</strong>ï¼šæ°´åˆ†è¾ƒå°‘æ—¶ï¼Œæ¤ç‰©ä¼šäº§ç”Ÿæ›´å¤šç³–åˆ†æ¥æé«˜ç»†èƒæ¶²æµ“åº¦ï¼Œé˜²æ­¢æ°´åˆ†æµå¤±ï¼ˆæ¸—é€è°ƒèŠ‚ï¼‰ï¼ŒåŒæ—¶æœå®å«æ°´é‡é™ä½ï¼Œç³–åˆ†ç›¸å¯¹æµ“ç¼©ã€‚</p>
            <p>â€¢ <strong>æ˜¼å¤œæ¸©å·®</strong>ï¼šç™½å¤©æ¸©åº¦é«˜ï¼Œå…‰åˆä½œç”¨å¼ºï¼Œåˆ¶é€ å¤§é‡ç³–åˆ†ï¼›å¤œæ™šæ¸©åº¦ä½ï¼Œå‘¼å¸ä½œç”¨å¼±ï¼Œæ¶ˆè€—ç³–åˆ†å°‘ï¼Œå‡€ç§¯ç´¯ç³–åˆ†å¤šã€‚</p>
            <p>â€¢ <strong>æ–°ç–†ç“œæœæ›´ç”œ</strong>ï¼šå¹²æ—±å°‘é›¨ï¼ˆæ°´åˆ†èƒè¿«ï¼‰ + æ˜¼å¤œæ¸©å·®å¤§ â†’ é«˜ç³–åº¦ç§¯ç´¯ + ä½å«æ°´é‡ â†’ ç‰¹åˆ«é¦™ç”œï¼</p>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ– ECharts å›¾è¡¨
        const chartDom = document.getElementById('chart');
        let myChart = echarts.init(chartDom);
        let option;
        let chartInitialized = false;

        // è·å–DOMå…ƒç´ 
        const waterSlider = document.getElementById('water-slider');
        const waterValue = document.getElementById('water-value');
        const tempSlider = document.getElementById('temp-slider');
        const tempValue = document.getElementById('temp-value');
        const daysSlider = document.getElementById('days-slider');
        const daysValue = document.getElementById('days-value');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const xinjiangBtn = document.getElementById('xinjiang-btn');
        const zhejiangBtn = document.getElementById('zhejiang-btn');
        const finalSugar = document.getElementById('final-sugar');
        const finalWater = document.getElementById('final-water');
        const efficiency = document.getElementById('efficiency');

        // æ›´æ–°æ»‘å—æ˜¾ç¤ºçš„å€¼
        function updateWaterValue() { waterValue.textContent = waterSlider.value + '%'; }
        function updateTempValue() { tempValue.textContent = tempSlider.value + 'Â°C'; }
        function updateDaysValue() { daysValue.textContent = daysSlider.value + ' å¤©'; }
        
        // åŒæ—¶ç›‘å¬inputå’Œchangeäº‹ä»¶ä»¥ç¡®ä¿å…¼å®¹æ€§
        waterSlider.addEventListener('input', updateWaterValue);
        waterSlider.addEventListener('change', updateWaterValue);
        tempSlider.addEventListener('input', updateTempValue);
        tempSlider.addEventListener('change', updateTempValue);
        daysSlider.addEventListener('input', updateDaysValue);
        daysSlider.addEventListener('change', updateDaysValue);
        
        // åˆå§‹åŒ–æ˜¾ç¤ºå€¼
        updateWaterValue();
        updateTempValue();
        updateDaysValue();

        // ç§‘å­¦æ¨¡å‹å‚æ•°ä¸çŠ¶æ€
        let dayData = [];
        let sugarData = [];
        let waterContentData = [];
        let isSimulating = false;
        let simulationInterval;

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            option = {
                title: {
                    text: 'ğŸˆ ç“œæœç”Ÿé•¿è¿‡ç¨‹æ¨¡æ‹Ÿ',
                    left: 'center',
                    textStyle: {
                        fontSize: 18,
                        color: '#2c3e50'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            backgroundColor: '#6a7985'
                        }
                    }
                },
                legend: {
                    data: ['ç³–åº¦ (Â°Bx)', 'å«æ°´é‡ (%)'],
                    bottom: 'auto',  // ä¸å›ºå®šåœ¨åº•éƒ¨
                    top: 'bottom',  // å›ºå®šåœ¨å›¾è¡¨æ­£ä¸Šæ–¹ï¼ˆæ ‡é¢˜ä¸‹æ–¹ï¼‰
                    textStyle: {
                        fontSize: 14,
                        padding: [5, 10]  // ä¸ºæ¯ä¸ªæ–‡æœ¬å¢åŠ å†…è¾¹è·
                    },
                    itemGap: 100,  // å¤§å¹…å¢åŠ å›¾ä¾‹é¡¹ä¹‹é—´çš„é—´è·
                    left: 'center',
                    orient: 'horizontal',
                    padding: 20,
                    // ä¸ä½¿ç”¨HTMLæ ‡ç­¾æ ¼å¼åŒ–ï¼Œé¿å…ä¹±ç é—®é¢˜
                    formatter: function(name) {
                        return name;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '12%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    name: 'æ¨¡æ‹Ÿå¤©æ•°',
                    nameLocation: 'middle',
                    nameGap: 30,
                    nameTextStyle: {
                        fontSize: 14,
                        fontWeight: 'bold'
                    },
                    axisLabel: {
                        fontSize: 12
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'ç³–åº¦ (Â°Bx)',
                        position: 'left',
                        axisLine: {
                            show: true,
                            lineStyle: { 
                                color: '#e74c3c',
                                width: 2
                            }
                        },
                        axisLabel: {
                            formatter: '{value}Â°Bx',
                            fontSize: 12
                        },
                        min: 0,
                        max: 25
                    },
                    {
                        type: 'value',
                        name: 'å«æ°´é‡ (%)',
                        position: 'right',
                        axisLine: {
                            show: true,
                            lineStyle: { 
                                color: '#3498db',
                                width: 2
                            }
                        },
                        axisLabel: {
                            formatter: '{value}%',
                            fontSize: 12
                        },
                        min: 60,
                        max: 90
                    }
                ],
                series: [
                    {
                        name: 'ç³–åº¦ (Â°Bx)',
                        type: 'line',
                        yAxisIndex: 0,
                        data: [],
                        lineStyle: { 
                            color: '#e74c3c', 
                            width: 4,
                            shadowColor: 'rgba(231, 76, 60, 0.3)',
                            shadowBlur: 10
                        },
                        itemStyle: { 
                            color: '#e74c3c',
                            borderWidth: 2
                        },
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        animationDuration: 2000,
                        animationEasing: 'cubicInOut'
                    },
                    {
                        name: 'å«æ°´é‡ (%)',
                        type: 'line',
                        yAxisIndex: 1,
                        data: [],
                        lineStyle: { 
                            color: '#3498db', 
                            width: 4,
                            shadowColor: 'rgba(52, 152, 219, 0.3)',
                            shadowBlur: 10
                        },
                        itemStyle: { 
                            color: '#3498db',
                            borderWidth: 2
                        },
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 8,
                        animationDuration: 2000,
                        animationEasing: 'cubicInOut'
                    }
                ]
            };
            myChart.setOption(option);
            chartInitialized = true;
        }

        // æ ¸å¿ƒç®—æ³•å‡½æ•° - æ¨¡æ‹Ÿç°å®ç”Ÿé•¿è¿‡ç¨‹
        function simulateGrowth() {
            console.log('å¼€å§‹æ¨¡æ‹ŸæŒ‰é’®è¢«ç‚¹å‡»');
            if (isSimulating) return;
            isSimulating = true;
            startBtn.disabled = true;
            startBtn.textContent = 'æ¨¡æ‹Ÿä¸­...';

            // é‡ç½®æ•°æ®
            dayData = [];
            sugarData = [];
            waterContentData = [];

            // è·å–ç”¨æˆ·è¾“å…¥çš„å‚æ•°
            const waterSupply = parseInt(waterSlider.value);
            const tempDifference = parseInt(tempSlider.value);
            const totalDays = parseInt(daysSlider.value);
            console.log('å‚æ•°:', waterSupply, tempDifference, totalDays);

            // åˆå§‹åŒ–å›¾è¡¨
            if (!chartInitialized) {
                initChart();
            }

            // ç§‘å­¦æ¨¡å‹å‚æ•°
            const baseSugar = 5.0;
            const baseWaterContent = 65.0;
            const waterEffectOnContent = 0.25;
            const tempEffectOnSugar = 0.03;
            const dailyGrowthRate = 0.2;

            // è®¡ç®—æ¨¡å‹å› å­
            const waterStressFactor = (100 - waterSupply) / 100;
            const tempGainFactor = 1 + (tempDifference * tempEffectOnSugar);

            // åˆå§‹çŠ¶æ€
            let currentSugar = baseSugar;
            const currentWaterContent = baseWaterContent + (waterSupply * waterEffectOnContent);

            // æ¨¡æ‹Ÿç”Ÿé•¿è¿‡ç¨‹
            for (let day = 0; day <= totalDays; day++) {
                if (day > 0) {
                    // æ¯æ—¥ç³–åº¦å˜åŒ– = åŸºç¡€ç”Ÿé•¿ Ã— æ¸©å·®å¢ç›Š + æ°´åˆ†èƒè¿«æ•ˆåº”
                    const dailySugarGain = (dailyGrowthRate * tempGainFactor) + 
                                         (currentSugar * waterStressFactor * 0.05);
                    currentSugar += dailySugarGain;
                    
                    // ç³–åº¦ä¸Šé™é™åˆ¶
                    currentSugar = Math.min(currentSugar, 24);
                }

                // è®°å½•æ•°æ®
                dayData.push(day);
                sugarData.push(parseFloat(currentSugar.toFixed(2)));
                waterContentData.push(parseFloat(currentWaterContent.toFixed(1)));
            }

            // æ›´æ–°æœ€ç»ˆç»“æœæ˜¾ç¤º
            const finalSugarValue = sugarData[sugarData.length - 1];
            const finalWaterValue = waterContentData[waterContentData.length - 1];
            const growthEfficiency = ((finalSugarValue - 5) / 19 * 100).toFixed(1);
            
            // å…ˆè®¾ç½®åˆå§‹å€¼ä¸º0ï¼Œç„¶åç”¨åŠ¨ç”»æ˜¾ç¤ºç»“æœ
            finalSugar.textContent = '0.0';
            finalWater.textContent = '0';
            efficiency.textContent = '0.0';

            // åŠ¨ç”»æ•ˆæœï¼šé€æ­¥ç»˜åˆ¶æ›²çº¿
            let currentFrame = 0;
            const totalFrames = dayData.length;
            const animationSugarData = [];
            const animationWaterData = [];

            clearInterval(simulationInterval);
            simulationInterval = setInterval(() => {
                if (currentFrame < totalFrames) {
                    animationSugarData.push(sugarData[currentFrame]);
                    animationWaterData.push(waterContentData[currentFrame]);

                    option.xAxis.data = dayData.slice(0, currentFrame + 1);
                    option.series[0].data = animationSugarData;
                    option.series[1].data = animationWaterData;
                    myChart.setOption(option);

                    // æ›´æ–°æ•°æ®æ˜¾ç¤º
                    if (currentFrame === totalFrames - 1) {
                        // æ·»åŠ æ•°å­—å˜åŒ–åŠ¨ç”»
                        animateNumber(finalSugar, 0, finalSugarValue, 1000);
                        animateNumber(finalWater, 0, finalWaterValue, 1000);
                        animateNumber(efficiency, 0, parseFloat(growthEfficiency), 1000);
                    }

                    currentFrame++;
                } else {
                    clearInterval(simulationInterval);
                    isSimulating = false;
                    startBtn.disabled = false;
                    startBtn.textContent = 'ğŸš€ å¼€å§‹æ¨¡æ‹Ÿ';
                }
            }, 50);
        }

        // æ•°å­—å˜åŒ–åŠ¨ç”»å‡½æ•°
        function animateNumber(element, start, end, duration) {
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                
                // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°è®©åŠ¨ç”»æ›´è‡ªç„¶
                const easeProgress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
                const currentValue = start + (end - start) * easeProgress;
                
                // æ ¹æ®å…ƒç´ IDå†³å®šæ˜¾ç¤ºæ ¼å¼
                if (element.id === 'final-water' || element.id === 'efficiency') {
                    element.textContent = currentValue.toFixed(1);
                } else {
                    element.textContent = currentValue.toFixed(1);
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function resetChart() {
            clearInterval(simulationInterval);
            isSimulating = false;
            startBtn.disabled = false;
            
            dayData = [];
            sugarData = [];
            waterContentData = [];
            
            finalSugar.textContent = '0.0';
            finalWater.textContent = '0';
            efficiency.textContent = '0.0';
            
            chartInitialized = false;
            myChart.dispose();
            myChart = echarts.init(chartDom);
        }

        function setXinjiangMode() {
            waterSlider.value = 30;
            tempSlider.value = 15;
            waterValue.textContent = '30%';
            tempValue.textContent = '15Â°C';
        }

        function setZhejiangMode() {
            waterSlider.value = 80;
            tempSlider.value = 8;
            waterValue.textContent = '80%';
            tempValue.textContent = '8Â°C';
        }

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        startBtn.addEventListener('click', simulateGrowth);
        resetBtn.addEventListener('click', resetChart);
        xinjiangBtn.addEventListener('click', setXinjiangMode);
        zhejiangBtn.addEventListener('click', setZhejiangMode);

        // çª—å£è‡ªé€‚åº”
        window.addEventListener('resize', function() {
            myChart.resize();
        });

        // åˆå§‹åŒ–é¡µé¢
        initChart();
    </script>
</body>
</html>